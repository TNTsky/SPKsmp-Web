<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>Sparkle æ¨¡çµ„åŒ…é è¨­éµä½ä¸€è¦½è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .config-section {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid #404040;
            width: 100%;
            max-width: 1200px;
        }

        .config-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            color: white;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: linear-gradient(145deg, #4a90e2, #357abd);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-weight: bold;
        }

        .file-input-label:hover {
            background: linear-gradient(145deg, #357abd, #2d6aa3);
            transform: translateY(-2px);
        }

        .download-btn {
            background: linear-gradient(145deg, #28a745, #1e7e34);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-weight: bold;
        }

        .download-btn:hover {
            background: linear-gradient(145deg, #1e7e34, #155724);
            transform: translateY(-2px);
        }

        .config-info {
            color: #ccc;
            font-size: 14px;
        }

        .keyboard-container {
            background: #2c2c2c;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid #404040;
        }

        .keyboard {
            display: grid;
            gap: 4px;
            max-width: 1200px;
        }

        .row {
            display: flex;
            gap: 4px;
            justify-content: flex-start;
        }

        .key {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            user-select: none;
            height: 45px;
            min-width: 45px;
        }

        /* éŠæˆ²é è¨­æŒ‰éµæ¨£å¼ */
        .key.default {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: #555;
        }

        .key.default:hover {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            border-color: #666;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* æ¨¡çµ„åŠŸèƒ½æŒ‰éµæ¨£å¼ */
        .key.mod {
            background: linear-gradient(145deg, #6a4c93, #5a3d7a);
            border-color: #8b5fbf;
        }

        .key.mod:hover {
            background: linear-gradient(145deg, #7a5ca3, #6a4c93);
            border-color: #9d71d1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 95, 191, 0.4);
        }

        .key:active {
            transform: translateY(0);
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
        }

        .key.pressed {
            background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
            border-color: #ff4757;
            transform: translateY(1px);
        }

        /* ç‰¹æ®ŠæŒ‰éµå°ºå¯¸ */
        .key.tab { width: 75px; }
        .key.caps { width: 90px; }
        .key.shift-left { width: 130px; }
        .key.shift-right { width: 125px; }
        .key.ctrl { width: 78px; }
        .key.alt { width: 65px; }
        .key.space { width: 300px; }
        .key.enter { width: 115px; }
        .key.backspace { width: 110px; }
        .key.backslash { width: 80px; }

        /* åŠŸèƒ½éµå€åŸŸ */
        .function-keys {
            margin-bottom: 15px;
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            border: 1px solid #555;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            white-space: normal;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip .key-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
        }

        .tooltip .key-type.default {
            background: #4a4a4a;
            color: #fff;
        }

        .tooltip .key-type.mod {
            background: #8b5fbf;
            color: #fff;
        }

        .tooltip .mod-name {
            display: block;
            margin-top: 4px;
            font-size: 11px;
            color: #aaa;
            font-style: italic;
        }

        .main-keyboard {
            display: flex;
            gap: 15px;
            align-items: flex-end; /* è®“æ‰€æœ‰å€åŸŸåº•éƒ¨å°é½Š */
        }

        .left-section {
            flex: 1;
        }

        .right-section {
            display: flex;
            gap: 15px;
            align-items: flex-end; /* æ¢å¾©åº•éƒ¨å°é½Š */
        }

        .nav-arrow-section {
            display: flex;
            flex-direction: column;
            gap: 38px;
            justify-content: flex-end; /* è®“æ–¹å‘éµå€åŸŸå‘ä¸‹å°é½Š */
            position: relative;
            top: 0px; /* å‘ä¸Šç§»å‹•å°èˆªéµå€åŸŸï¼Œè®“Insertå°é½ŠBackspace */
        }

        .nav-cluster {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 4px;
        }

        .arrow-cluster {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left down right";
            gap: 4px;
        }

        .arrow-up { grid-area: up; }
        .arrow-left { grid-area: left; }
        .arrow-down { grid-area: down; }
        .arrow-right { grid-area: right; }

        .numpad-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
        }

        .key.numpad-0 { grid-column: span 2; width: 94px; }
        .key.numpad-plus { grid-row: span 2; height: 94px; }
        .key.numpad-enter { grid-row: span 2; height: 94px; }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            color: #ccc;
            font-size: 14px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            color: white;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #666;
        }

        .legend-color.default {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
        }

        .legend-color.mod {
            background: linear-gradient(145deg, #6a4c93, #5a3d7a);
        }

        .addon-section {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 20px;
        }

        .combo-keys {
            flex: 1;
            color: white;
        }

        .combo-keys h3 {
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 1px solid #666;
            padding-bottom: 5px;
        }

        .combo-table {
            width: 100%;
            border-collapse: collapse;
        }

        .combo-table td {
            border: 1px solid #888;
            padding: 5px 10px;
            font-size: 12px;
            text-align: left;
        }

        .combo-key {
            display: inline-block;
            padding: 3px 6px;
            margin-right: 4px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            font-size: 11px;
        }

        .search-panel {
            flex: 1;
            color: white;
        }

        .search-panel h3 {
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 1px solid #666;
            padding-bottom: 5px;
        }

        .search-input {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #666;
            border-radius: 5px;
            background: #1c1c1c;
            color: white;
        }

        .search-result {
            margin-top: 10px;
            font-size: 13px;
        }

        .search-result div {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="keyboard-container">
        <div class="header">
            <h1>Sparkle æ¨¡çµ„åŒ…é è¨­éµä½ä¸€è¦½è¡¨</h1>
            <p>å°‡æ»‘é¼ ç§»å‹•åˆ°æŒ‰éµä¸ŠæŸ¥çœ‹åŠŸèƒ½å°æ‡‰</p>
        </div>
        
        <div id="rotateNotice" style="
            display:none;
            position:fixed;
            top:0;left:0;right:0;bottom:0;
            background:rgba(0,0,0,0.85);
            color:white;
            font-size:18px;
            z-index:9999;
            text-align:center;
            padding-top:40%;
        ">
            ğŸ“± è«‹å°‡è£ç½®æ©«éä¾†ä»¥æ­£å¸¸é¡¯ç¤ºéµç›¤
        </div>
        <script>
        function checkOrientation() {
            const notice = document.getElementById('rotateNotice');
            if (window.innerHeight > window.innerWidth) {
                notice.style.display = 'block'; // ç›´ç«‹æ¨¡å¼é¡¯ç¤º
            } else {
                notice.style.display = 'none'; // æ©«å‘éš±è—
            }
        }
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
        checkOrientation();
        </script>


        <!-- åŠŸèƒ½éµå€ -->
        <div class="function-keys">
            <div class="row">
                <div class="key default" data-key="Escape">Esc</div>
                <div style="width: 50px;"></div>
                <div class="key default" data-key="F1">F1</div>
                <div class="key default" data-key="F2">F2</div>
                <div class="key default" data-key="F3">F3</div>
                <div class="key default" data-key="F4">F4</div>
                <div style="width: 25px;"></div>
                <div class="key default" data-key="F5">F5</div>
                <div class="key default" data-key="F6">F6</div>
                <div class="key default" data-key="F7">F7</div>
                <div class="key default" data-key="F8">F8</div>
                <div style="width: 25px;"></div>
                <div class="key default" data-key="F9">F9</div>
                <div class="key default" data-key="F10">F10</div>
                <div class="key default" data-key="F11">F11</div>
                <div class="key default" data-key="F12">F12</div>
                <div style="width: 10px;"></div>
                <div class="key default" data-key="PrintScreen">PrtSc</div>
                <div class="key default" data-key="ScrollLock">ScrLk</div>
                <div class="key default" data-key="Pause">Pause</div>
            </div>
        </div>

        <div class="main-keyboard">
            <div class="left-section">
                <!-- æ•¸å­—åˆ— -->
                <div class="row">
                    <div class="key default" data-key="`">~</div>
                    <div class="key default" data-key="1">1</div>
                    <div class="key default" data-key="2">2</div>
                    <div class="key default" data-key="3">3</div>
                    <div class="key default" data-key="4">4</div>
                    <div class="key default" data-key="5">5</div>
                    <div class="key default" data-key="6">6</div>
                    <div class="key default" data-key="7">7</div>
                    <div class="key default" data-key="8">8</div>
                    <div class="key default" data-key="9">9</div>
                    <div class="key default" data-key="0">0</div>
                    <div class="key default" data-key="-">-</div>
                    <div class="key default" data-key="=">=</div>
                    <div class="key backspace default" data-key="Backspace">Backspace</div>
                </div>

                <!-- ç¬¬ä¸€æ’å­—æ¯ -->
                <div class="row">
                    <div class="key tab default" data-key="Tab">Tab</div>
                    <div class="key default" data-key="q">Q</div>
                    <div class="key default" data-key="w">W</div>
                    <div class="key default" data-key="e">E</div>
                    <div class="key default" data-key="r">R</div>
                    <div class="key default" data-key="t">T</div>
                    <div class="key default" data-key="y">Y</div>
                    <div class="key default" data-key="u">U</div>
                    <div class="key default" data-key="i">I</div>
                    <div class="key default" data-key="o">O</div>
                    <div class="key default" data-key="p">P</div>
                    <div class="key default" data-key="[">[</div>
                    <div class="key default" data-key="]">]</div>
                    <div class="key backslash default" data-key="\\">\\</div>
                </div>

                <!-- ç¬¬äºŒæ’å­—æ¯ -->
                <div class="row">
                    <div class="key caps default" data-key="CapsLock">Caps Lock</div>
                    <div class="key default" data-key="a">A</div>
                    <div class="key default" data-key="s">S</div>
                    <div class="key default" data-key="d">D</div>
                    <div class="key default" data-key="f">F</div>
                    <div class="key default" data-key="g">G</div>
                    <div class="key default" data-key="h">H</div>
                    <div class="key default" data-key="j">J</div>
                    <div class="key default" data-key="k">K</div>
                    <div class="key default" data-key="l">L</div>
                    <div class="key default" data-key=";">;</div>
                    <div class="key default" data-key="'">'</div>
                    <div class="key enter default" data-key="Enter">Enter</div>
                </div>

                <!-- ç¬¬ä¸‰æ’å­—æ¯ -->
                <div class="row">
                    <div class="key shift-left default" data-key="ShiftLeft">Shift</div>
                    <div class="key default" data-key="z">Z</div>
                    <div class="key default" data-key="x">X</div>
                    <div class="key default" data-key="c">C</div>
                    <div class="key default" data-key="v">V</div>
                    <div class="key default" data-key="b">B</div>
                    <div class="key default" data-key="n">N</div>
                    <div class="key default" data-key="m">M</div>
                    <div class="key default" data-key="Comma">,</div>
                    <div class="key default" data-key=".">.</div>
                    <div class="key default" data-key="/">/</div>
                    <div class="key shift-right default" data-key="ShiftRight">Shift</div>
                </div>

                <!-- æœ€åº•æ’ -->
                <div class="row">
                    <div class="key ctrl default" data-key="ControlLeft">Ctrl</div>
                    <div class="key default" data-key="MetaLeft">Win</div>
                    <div class="key alt default" data-key="AltLeft">Alt</div>
                    <div class="key space default" data-key="Space">Space</div>
                    <div class="key alt default" data-key="AltRight">Alt</div>
                    <div class="key default" data-key="MetaRight">Win</div>
                    <div class="key default" data-key="ContextMenu">Menu</div>
                    <div class="key ctrl default" data-key="ControlRight">Ctrl</div>
                </div>
            </div>

            <div class="right-section">
                <div class="nav-arrow-section">
                    <!-- å°èˆªéµç¾¤çµ„ -->
                    <div class="nav-cluster">
                        <div class="key default" data-key="Insert">Insert</div>
                        <div class="key default" data-key="Home">Home</div>
                        <div class="key default" data-key="PageUp">PgUp</div>
                        <div class="key default" data-key="Delete">Delete</div>
                        <div class="key default" data-key="End">End</div>
                        <div class="key default" data-key="PageDown">PgDn</div>
                    </div>

                    <!-- æ–¹å‘éµ -->
                    <div class="arrow-cluster">
                        <div class="key arrow-up default" data-key="ArrowUp">â†‘</div>
                        <div class="key arrow-left default" data-key="ArrowLeft">â†</div>
                        <div class="key arrow-down default" data-key="ArrowDown">â†“</div>
                        <div class="key arrow-right default" data-key="ArrowRight">â†’</div>
                    </div>
                </div>

                <!-- æ•¸å­—éµç›¤ -->
                <div class="numpad-grid">
                    <div class="key default" data-key="NumLock">Num</div>
                    <div class="key default" data-key="NumpadDivide">Ã·</div>
                    <div class="key default" data-key="NumpadMultiply">Ã—</div>
                    <div class="key default" data-key="NumpadSubtract">-</div>
                    <div class="key default" data-key="Numpad7">7</div>
                    <div class="key default" data-key="Numpad8">8</div>
                    <div class="key default" data-key="Numpad9">9</div>
                    <div class="key numpad-plus default" data-key="NumpadAdd">+</div>
                    <div class="key default" data-key="Numpad4">4</div>
                    <div class="key default" data-key="Numpad5">5</div>
                    <div class="key default" data-key="Numpad6">6</div>
                    <div class="key default" data-key="Numpad1">1</div>
                    <div class="key default" data-key="Numpad2">2</div>
                    <div class="key default" data-key="Numpad3">3</div>
                    <div class="key numpad-enter default" data-key="NumpadEnter">Enter</div>
                    <div class="key numpad-0 default" data-key="Numpad0">0</div>
                    <div class="key default" data-key="NumpadDecimal">.</div>
                </div>
            </div>
        </div>

        <div class="addon-section">
            <div class="combo-keys">
                <h3>å¸¸ç”¨æ¨¡çµ„çµ„åˆéµ</h3>
                <table class="combo-table">
                    <tr><td><span class="combo-key">X</span>+<span class="combo-key">C</span></td><td>Tweakeroo è¨­å®š</td></tr>
                    <tr><td><span class="combo-key">H</span>+<span class="combo-key">C</span></td><td>MiniHUDè¨­å®š</td></tr>
                    <tr><td><span class="combo-key">M</span>+<span class="combo-key">R</span></td><td>æŠ•å½±é¡¯ç¤ºé–‹é—œ</td></tr>
                    <tr><td><span class="combo-key">M</span>+<span class="combo-key">PageUp</span></td><td>ä¸‹ä¸€æ¸²æŸ“æ¨¡å¼</td></tr>
                    <tr><td><span class="combo-key">M</span>+<span class="combo-key">PageDown</span></td><td>ä¸Šä¸€æ¸²æŸ“æ¨¡å¼</td></tr>
                    <tr><td><span class="combo-key">M</span>+<span class="combo-key">V</span></td><td>åŸç†åœ–é©—è­‰å™¨</td></tr>
                    <tr><td><span class="combo-key">M</span>+<span class="combo-key">L</span></td><td>ææ–™æ¸…å–®</td></tr>
                    <tr><td><span class="combo-key">A</span>+<span class="combo-key">C</span></td><td>Malilibè¨­å®š</td></tr>
                </table>
            </div>

            <div class="search-panel">
                <h3>åŠŸèƒ½æœå°‹</h3>
                <input type="text" id="searchBox" class="search-input" placeholder="è¼¸å…¥åŠŸèƒ½åç¨±...">
                <div id="searchResults" class="search-result"></div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color default"></div>
                <span>åŸç‰ˆåŠŸèƒ½</span>
            </div>
            <div class="legend-item">
                <div class="legend-color mod"></div>
                <span>æ¨¡çµ„åŠŸèƒ½</span>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        class ConfigurableKeyboard {
            constructor() {
                this.keys = document.querySelectorAll('.key');
                this.tooltip = document.getElementById('tooltip');
                this.pressedKeys = new Set();
                this.keyConfig = new Map();
                this.init();
            }

            init() {
                this.keys.forEach(key => {
                    // æ»‘é¼ äº‹ä»¶
                    key.addEventListener('mouseenter', (e) => this.showTooltip(e));
                    key.addEventListener('mouseleave', () => this.hideTooltip());
                    key.addEventListener('mousemove', (e) => this.updateTooltipPosition(e));
                    key.addEventListener('click', (e) => this.handleKeyClick(e));

                    key.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                    key.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                });

                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                document.addEventListener('keyup', (e) => this.handleKeyUp(e));
                
                window.addEventListener('blur', () => this.clearAllPressed());

                const configFileEl = document.getElementById('configFile');
                if (configFileEl) {
                    configFileEl.addEventListener('change', (e) => this.loadConfigFile(e));
                }

                this.loadMinecraftConfig();
                
                // åˆå§‹åŒ–æœå°‹åŠŸèƒ½ï¼ˆéœ€è¦åœ¨è¼‰å…¥é…ç½®å¾ŒåŸ·è¡Œï¼‰
                this.initSearch();
            }

            initSearch() {
                const searchBox = document.getElementById('searchBox');
                const searchResults = document.getElementById('searchResults');
                
                if (searchBox && searchResults) {
                    searchBox.addEventListener('input', (e) => {
                        const query = e.target.value.trim().toLowerCase();
                        searchResults.innerHTML = '';

                        if (!query) return;

                        const matched = Array.from(this.keys)
                            .map(key => ({
                                key: key.getAttribute('data-key'),
                                func: key.getAttribute('data-game-key') || '',
                                type: key.getAttribute('data-key-type') || 'default',
                                mod: key.getAttribute('data-mod-name') || ''
                            }))
                            .filter(item => 
                                item.func.toLowerCase().includes(query) || 
                                item.mod.toLowerCase().includes(query)
                            );

                        if (matched.length === 0) {
                            searchResults.innerHTML = '<div>æœªæ‰¾åˆ°ç¬¦åˆçš„åŠŸèƒ½ã€‚</div>';
                        } else {
                            matched.forEach(item => {
                                const row = document.createElement('div');
                                let displayText = `éµä½: ${item.key} | åŠŸèƒ½: ${item.func}`;
                                if (item.type === 'mod' && item.mod) {
                                    displayText += ` | æ¨¡çµ„: ${item.mod}`;
                                }
                                row.textContent = displayText;
                                searchResults.appendChild(row);
                            });
                        }
                    });
                }
            }

            hideTooltip() {
                this.tooltip.classList.remove('show');
            }

            updateTooltipPosition(event) {
                const rect = event.target.getBoundingClientRect();
                const tooltipRect = this.tooltip.getBoundingClientRect();
                
                let left = rect.left + rect.width / 2 - tooltipRect.width / 2;
                let top = rect.top - tooltipRect.height - 10;
                
                // ç¢ºä¿å·¥å…·æç¤ºä¸æœƒè¶…å‡ºè¢å¹•é‚Šç•Œ
                if (left < 10) left = 10;
                if (left + tooltipRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipRect.width - 10;
                }
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                this.tooltip.style.left = left + 'px';
                this.tooltip.style.top = top + 'px';
            }

            handleKeyClick(event) {
                const key = event.target;
                const keyName = key.getAttribute('data-key');
                
                // æ·»åŠ é»æ“Šå‹•ç•«
                key.style.transform = 'translateY(2px)';
                setTimeout(() => {
                    key.style.transform = '';
                }, 100);

                console.log(`éµç›¤æŒ‰éµè¢«é»æ“Š: ${keyName}`);
            }

            handleMouseDown(event) {
                event.target.classList.add('pressed');
            }

            handleMouseUp(event) {
                event.target.classList.remove('pressed');
            }

            handleKeyDown(event) {
                // é˜²æ­¢é‡è¤‡è§¸ç™¼
                if (this.pressedKeys.has(event.code)) return;
                
                this.pressedKeys.add(event.code);
                const keyElement = this.findKeyElement(event.code);
                
                if (keyElement) {
                    keyElement.classList.add('pressed');
                    console.log(`å¯¦é«”éµç›¤æŒ‰ä¸‹: ${event.code}`);
                }
            }

            loadMinecraftConfig() {
                const minecraftConfig = 
`Escape,æš«åœé¸å–®,default
F1,éš±è—HUD,default
F2,æˆªåœ–,default
F3,åµéŒ¯ç•«é¢,default
F4,æœªä½¿ç”¨,default
F5,ç¬¬ä¸‰äººç¨±è¦–è§’,default
F6,æœªä½¿ç”¨,default
F7,é¡¯ç¤ºäº®åº¦ç­‰ç´š,mod,Tweakeroo
F8,æœªä½¿ç”¨,default
F9,æ›´æ”¹æ‰‹é•·,mod,Tweakeroo
F10,æœªä½¿ç”¨,default
F11,å…¨è¢å¹•,default
F12,é–‹é—œæŒ–æ˜å†·å»,mod,Tweakeroo
PrintScreen,æˆªåœ–(Windowsè‡ªå¸¶),default
ScrollLock,æœªä½¿ç”¨,default
Pause,æœªä½¿ç”¨,default
\`,å½æ½›è¡Œ,mod,Tweakeroo
1,å¿«æ·æ¬„1,default
2,å¿«æ·æ¬„2,default
3,å¿«æ·æ¬„3,default
4,å¿«æ·æ¬„4,default
5,å¿«æ·æ¬„5,default
6,å¿«æ·æ¬„6,default
7,å¿«æ·æ¬„7,default
8,å¿«æ·æ¬„8,default
9,å¿«æ·æ¬„9,default
0,æ”¾ç½®é™åˆ¶,mod,Tweakeroo
-,å…‰å½±é¸æ“‡,mod,Iris
=,å…‰å½±é–‹é—œ,mod,Iris
Backspace,æœªä½¿ç”¨,default
Tab,ç©å®¶åˆ—è¡¨,default
q,ä¸Ÿæ£„ç‰©å“,default
w,å‘å‰ç§»å‹•,default
e,æ‰“é–‹ç‰©å“æ¬„,default
r,è¼•é¬†æ”¾ç½®æ¨¡å¼,mod,Tweakeroo
t,èŠå¤©,default
y,å°åœ°åœ–è¨­å®š,mod,Xaero's Minimap
u,ä¿®å¾©æ¨¡å¼,mod,Tweakeroo
i,æŠ•å½±å®¹å™¨é è¦½,mod,Litematica
o,è‡ªç”±è¦–è§’,mod,Tweakeroo
p,æœªè¨­å®š(ç§»é™¤åŸç‰ˆåŠŸèƒ½),default
[,é‡æ–°è¼‰å…¥å…‰å½±,mod,Iris
],æœªä½¿ç”¨,default
\\,æœªä½¿ç”¨,default
CapsLock,æœªè¨­å®š,default
a,å‘å·¦ç§»å‹•,default
s,å‘å¾Œç§»å‹•,default
d,å‘å³ç§»å‹•,default
f,åˆ‡æ›ä¸»å‰¯æ‰‹ç‰©å“,default
g,æœªä½¿ç”¨,default
h,MiniHUDé–‹é—œ,mod,MiniHUD
j,æ‰“å°æ©Ÿæ¨¡å¼åˆ‡æ›,mod,Litematica
k,ç¢°æ’ç®±é¡¯ç¤º,mod,MiniHUD
l,å½¢ç‹€æ¸²æŸ“å™¨,mod,MiniHUD
;,æœªä½¿ç”¨,default
',æœªä½¿ç”¨,default
Enter,è²¼ä¸ŠæŠ•å½±(å‰µé€ æ¨¡å¼/æŠ•å½±æ¨¡å¼5),mod,Litematica
ShiftLeft,æ½›è¡Œ,default
z,å°åœ°åœ–æ”¾å¤§,mod,Xaero's Minimap
x,æœªä½¿ç”¨,default
c,æ”¾å¤§,mod,Tweakeroo
v,æœªä½¿ç”¨,default
b,æ–°å¢å®šä½é»,mod,Xaero's Minimap
n,è‡ªå‹•å·¥å…·åˆ‡æ›,mod,Tweakeroo
m,æŠ•å½±èœå–®,mod,Litematica
Comma,é–‹å•Ÿå°åœ°åœ–,mod,Xaero's Minimap
.,éˆæ´»æ”¾ç½®,mod,Tweakeroo
/,æŒ‡ä»¤,default
ShiftRight,æœªä½¿ç”¨,default
ControlLeft,ç–¾è·‘/éˆæ´»æ”¾ç½®,mod,Tweakeroo
MetaLeft,Windows,default
AltLeft,å®¹å™¨é è¦½,mod,Tweakeroo
Space,è·³èº,default
AltRight,æœªä½¿ç”¨,default
MetaRight,Windows,default
ContextMenu,æœªä½¿ç”¨,default
ControlRight,åŸç†åœ–é€è¦–,mod,Litematica
Insert,æœªä½¿ç”¨,default
Home,æœªä½¿ç”¨,default
PageUp,æŠ•å½±å¾€ä¸Šä¸€å±¤,mod,Litematica
Delete,æœªä½¿ç”¨,default
End,æœªä½¿ç”¨,default
PageDown,æŠ•å½±å¾€ä¸‹ä¸€å±¤,mod,Litematica
ArrowUp,æœªä½¿ç”¨,default
ArrowLeft,æœªä½¿ç”¨,default
ArrowDown,æœªä½¿ç”¨,default
ArrowRight,æœªä½¿ç”¨,default
NumLock,æœªä½¿ç”¨,default
NumpadDivide,é—œé–‰ç²’å­é¡¯ç¤º,mod,Tweakeroo
NumpadMultiply,å€åŸŸé¸æ“‡å™¨,mod,Litematica
NumpadSubtract,åŸç†åœ–æ”¾ç½®,mod,Litematica
Numpad7,å¿«é€Ÿå·¦éµ,mod,Tweakeroo
Numpad8,å¿«é€Ÿæ”¾ç½®,mod,Tweakeroo
Numpad9,å¿«é€Ÿå³éµ,mod,Tweakeroo
NumpadAdd,Gammaä¿®æ”¹,mod,Tweakeroo
Numpad4,å®šæ™‚å·¦éµ,mod,Tweakeroo
Numpad5,è‡ªå‹•æ”¾ç½®åŒé¡æ–¹å¡Š,mod,Tweakeroo
Numpad6,å®šæ™‚å³éµ,mod,Tweakeroo
Numpad1,æŒ‰ä½å·¦éµ,mod,Tweakeroo
Numpad2,é£›è¡ŒåŠ é€Ÿ(æŒ‰ä½åŠ æ»¾è¼ªä¿®æ”¹é€Ÿåº¦),mod,Tweakeroo
Numpad3,æŒ‰ä½å³éµ,mod,Tweakeroo
NumpadEnter,æœªä½¿ç”¨,default
Numpad0,Jadeè¨­å®š,mod,Jade
NumpadDecimal,æŠ•å½±æ‰“å°æ©Ÿé–‹é—œ,mod,Litematica`;

                this.parseConfigText(minecraftConfig);
            }

            parseConfigText(text) {
                this.keyConfig.clear();
                const lines = text.trim().split('\n');
                
                lines.forEach(line => {
                    if (line.startsWith('#') || line.trim() === '') return; 
                    const parts = line.split(',').map(part => part.trim());
                    if (parts.length >= 3) {
                        const [keyName, function_, type, modName] = parts;
                        this.keyConfig.set(keyName, {
                            function: function_,
                            type: type,
                            modName: modName || '' // æ¨¡çµ„åç¨±ï¼Œå¯é¸
                        });
                    }
                });

                this.updateKeyboardDisplay();
            }

            updateKeyboardDisplay() {
                this.keys.forEach(key => {
                    const keyName = key.getAttribute('data-key');
                    const config = this.keyConfig.get(keyName);
                    
                    if (config) {
                        key.classList.remove('default', 'mod');
                        key.classList.add(config.type);
                        key.setAttribute('data-game-key', config.function);
                        key.setAttribute('data-key-type', config.type);
                        
                        // æ¨¡çµ„åç¨±å±¬æ€§
                        if (config.modName) {
                            key.setAttribute('data-mod-name', config.modName);
                        } else {
                            key.removeAttribute('data-mod-name');
                        }
                    }
                });
            }

            showTooltip(event) {
                const key = event.target;
                const gameKey = key.getAttribute('data-game-key');
                const keyName = key.getAttribute('data-key');
                const keyType = key.getAttribute('data-key-type') || 'default';
                const modName = key.getAttribute('data-mod-name');
                
                if (gameKey) {
                    const typeLabel = keyType === 'mod' ? 'æ¨¡çµ„åŠŸèƒ½' : 'åŸç‰ˆåŠŸèƒ½';
                    const typeClass = keyType === 'mod' ? 'mod' : 'default';
                    
                    let tooltipContent = `
                        <div><strong>æŒ‰éµ:</strong> ${keyName}</div>
                        <div><strong>åŠŸèƒ½:</strong> ${gameKey} <span class="key-type ${typeClass}">${typeLabel}</span></div>
                    `;

                    if (keyType === 'mod' && modName) {
                        tooltipContent += `<div class="mod-name">æ¨¡çµ„: ${modName}</div>`;
                    }
                    
                    this.tooltip.innerHTML = tooltipContent;
                    this.tooltip.classList.add('show');
                    this.updateTooltipPosition(event);
                }
            }

            handleKeyUp(event) {
                this.pressedKeys.delete(event.code);
                const keyElement = this.findKeyElement(event.code);
                
                if (keyElement) {
                    keyElement.classList.remove('pressed');
                    console.log(`å¯¦é«”éµç›¤æ”¾é–‹: ${event.code}`);
                }
            }

            findKeyElement(code) {
                // éµç¢¼æ˜ å°„è¡¨
                const keyMap = {
                    'Escape': 'Escape',
                    'F1': 'F1', 'F2': 'F2', 'F3': 'F3', 'F4': 'F4',
                    'F5': 'F5', 'F6': 'F6', 'F7': 'F7', 'F8': 'F8',
                    'F9': 'F9', 'F10': 'F10', 'F11': 'F11', 'F12': 'F12',
                    'Backquote': '`',
                    'Digit1': '1', 'Digit2': '2', 'Digit3': '3', 'Digit4': '4', 'Digit5': '5',
                    'Digit6': '6', 'Digit7': '7', 'Digit8': '8', 'Digit9': '9', 'Digit0': '0',
                    'Minus': '-', 'Equal': '=', 'Backspace': 'Backspace',
                    'Tab': 'Tab',
                    'KeyQ': 'q', 'KeyW': 'w', 'KeyE': 'e', 'KeyR': 'r', 'KeyT': 't',
                    'KeyY': 'y', 'KeyU': 'u', 'KeyI': 'i', 'KeyO': 'o', 'KeyP': 'p',
                    'BracketLeft': '[', 'BracketRight': ']', 'Backslash': '\\',
                    'CapsLock': 'CapsLock',
                    'KeyA': 'a', 'KeyS': 's', 'KeyD': 'd', 'KeyF': 'f', 'KeyG': 'g',
                    'KeyH': 'h', 'KeyJ': 'j', 'KeyK': 'k', 'KeyL': 'l',
                    'Semicolon': ';', 'Quote': "'", 'Enter': 'Enter',
                    'ShiftLeft': 'ShiftLeft',
                    'KeyZ': 'z', 'KeyX': 'x', 'KeyC': 'c', 'KeyV': 'v', 'KeyB': 'b',
                    'KeyN': 'n', 'KeyM': 'm', 'Comma': 'Comma', 'Period': '.', 'Slash': '/',
                    'ShiftRight': 'ShiftRight',
                    'ControlLeft': 'ControlLeft', 'MetaLeft': 'MetaLeft', 'AltLeft': 'AltLeft',
                    'Space': 'Space',
                    'AltRight': 'AltRight', 'MetaRight': 'MetaRight', 'ContextMenu': 'ContextMenu',
                    'ControlRight': 'ControlRight',
                    'PrintScreen': 'PrintScreen', 'ScrollLock': 'ScrollLock', 'Pause': 'Pause',
                    'Insert': 'Insert', 'Home': 'Home', 'PageUp': 'PageUp',
                    'Delete': 'Delete', 'End': 'End', 'PageDown': 'PageDown',
                    'ArrowUp': 'ArrowUp', 'ArrowLeft': 'ArrowLeft', 'ArrowDown': 'ArrowDown', 'ArrowRight': 'ArrowRight',
                    'NumLock': 'NumLock', 'NumpadDivide': 'NumpadDivide', 'NumpadMultiply': 'NumpadMultiply', 'NumpadSubtract': 'NumpadSubtract',
                    'Numpad7': 'Numpad7', 'Numpad8': 'Numpad8', 'Numpad9': 'Numpad9', 'NumpadAdd': 'NumpadAdd',
                    'Numpad4': 'Numpad4', 'Numpad5': 'Numpad5', 'Numpad6': 'Numpad6',
                    'Numpad1': 'Numpad1', 'Numpad2': 'Numpad2', 'Numpad3': 'Numpad3', 'NumpadEnter': 'NumpadEnter',
                    'Numpad0': 'Numpad0', 'NumpadDecimal': 'NumpadDecimal'
                };

                const mappedKey = keyMap[code];
                if (mappedKey) {
                    return document.querySelector(`[data-key="${mappedKey}"]`);
                }
                return null;
            }

            clearAllPressed() {
                this.pressedKeys.clear();
                this.keys.forEach(key => {
                    key.classList.remove('pressed');
                });
            }
        }

        // åˆå§‹åŒ–éµç›¤
        document.addEventListener('DOMContentLoaded', () => {
            new ConfigurableKeyboard();
        });
    </script>
</body>
